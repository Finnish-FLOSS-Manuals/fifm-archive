<html dir="None"><body><div id="main-content"><h1>Customising Potlatch 2
</h1>
<p>All that you need to run Potlatch 2 is a Flash-compatible browser and an Internet connection. To customize Potlatch 2, you simply need a basic web server and permissions to upload files to it. You do not need to know Flash or Actionscript. You do not have to build Potlatch 2.<br></p>
<p>Potlatch 2 has a feature that allows you to style and customise the editor to specific needs. You can take the Potlatch 2 editor and put it on your own website, making it easy for a user to add or edit OpenStreetMap data relevant to the specific interests of your website. For example, the CycleStreets website (<a href="http://www.cyclestreets.net/">http://www.cyclestreets.net/</a>) provides journey planning for cyclists using OpenStreetMap data. CycleStreet provides a customised online editor making it easier for people to add data that is relevant to cyclists and help with the improvement of the journey planner. Another example is OpenEcoMaps (<a href="http://www.openecomaps.co.uk" target="" title="">http://www.openecomaps.co.uk</a>) by Tom Chance, which is about green spaces.
</p>
<p>You can change the style of the map and the controls on the left hand side of the map without writing any Flash/ActionScript code or compiling Potlatch 2. It does require you to know the basics of running a webserver, however, as well as HTML and JavaScript.
</p>
<h2>Deploying Potlatch 2 to your own site
</h2>
<p>You can add Potlatch 2 to your own site without making any customisations. This approach is a good way to get started.
</p>
<h3>Getting the files
</h3>
<p>Download all the files from <a href="http://random.dev.openstreetmap.org/potlatch2/">http://random.dev.openstreetmap.org/potlatch2/</a>, including the full contents of the <code>features/</code>, <code>icons/</code> and <code>fills/</code> directories. These are the resource files that are required by Potlatch 2.
</p>
<p>The actual application itself is the potlatch2.swf file. The potlatch2.html file is an example file of a webpage your users could visit to use the customized additions. The Potlatch 2 swf and resources are updated often, so update your files regularly to ensure you get the latest improvements!
</p>
<p>Upload all the files in the potlatch2 directory to a directory on your web server. The potlatch2.swf and potlatch2.html should be in the potlatch2 directory, but you should overwrite the example files in the potlatch2 directory using the following example.
  <br></p>
<h3>Setting up Potlatch 2
</h3>
<p>There are some settings that need to be modified from the potlatch2.swf file to have the application working on your own website.
</p>
<p>First you need to specify the starting location and zoom level of the map. In order to do this you pass in the query parameters <code>lat</code>, <code>lon</code> and <code>zoom</code> at the end of the url. Remember that zoom levels go from 1 until 18 and that 1 is a worldview and 18 is very close. For example if your URL is http://mycustompotlatch2.com/potlatch2.html you will want to add the following to the end "?<code>lat=53.293456&amp;lon=-6.20537&amp;zoom=17"</code>. You also can specify the default location for when the query parameter has not been passed in within the html file with the lines:
</p>
<blockquote>
  <pre>lat=53.2934;
lon=-6.2053;
zoom=16;</pre>
</blockquote>
<p>
</p>
<p>The default configuration of the potlatch2.html configuration file points to an OpenStreetMap development server. You can use this server for testing with no consequences if you make a mistake. When you are done testing and wish to use the main OpenStreetMap server replace "api06.dev" with "www".
</p>
<blockquote>
  <pre>args["api"] = "http://api06.dev.openstreetmap.org/api/0.6/";
args["policy"] = "http://api06.dev.openstreetmap.org/api/crossdomain.xml";
args["oauth_policy"] = "http://api06.dev.openstreetmap.org/oauth/crossdomain.xml";
args["oauth_request_url"] = "http://api06.dev.openstreetmap.org/oauth/request_token";
args["oauth_access_url"] = "http://api06.dev.openstreetmap.org/oauth/access_token";
args["oauth_auth_url"] = "http://api06.dev.openstreetmap.org/oauth/authorize";
args["serverName"] = "api06 Test On Dev";</pre>
</blockquote>
<p>
</p>
<p>You can use Potlatch 2 immediately to view map information from your own website. This works both on the development server and the main OpenStreetMap server. However, in order to actually edit the data you must register your website as a new application in OpenStreetMap. To do this you need an OpenStreetMap account and to be logged into the OpenStreetMap website. </p><p>Click on your username in the right corner of the webpage to go to your OpenStreetMap user page. Then click <strong>oauth settings</strong>, and <strong>Register your application</strong> at the very bottom of the page. Note that you must register the application for every website where you customise Potlatch 2. To be able to test against the testing server (api06.dev.openstreetmap.org), you must also register on that server.
</p>
<p><em>Note: You can not open the page via the file system locally on your computer and talk to the OSM server since Flash security does not allow this.</em></p>
<p><span class="Apple-style-span">When prompted, enter the name of your instance (e.g. "My Custom Potlatch 2") and its URL (e.g. "http://</span>mycustompotlatch2.com<span class="Apple-style-span">/"). </span>
</p>
<p><span class="Apple-style-span">Under 'Callback URL', you can optionally enter a intermediary page that lets your users know they are logged in and can begin editing on your website. Under 'Support URL', you can optionally enter a help URL if you have additional documentation for your instance of Potlatch 2.</span>
</p>
<p><img src="_booki/openstreetmap/static/Screen%20Shot%202011-10-18%20at%2016.47.43.png"><br></p>
<p>For your instance of Potlatch 2 to work you check the <strong>modify the map </strong>checkbox and click <strong>Register</strong>. You will be given an OAuth 'consumer key' and 'consumer secret'. Copy and paste them into the relevant lines in your html file as is shown in the example below.
</p>
<blockquote>
  <pre>args["oauth_consumer_key"] = "fiM1IoqnKJk4JCfcl63DA";
args["oauth_consumer_secret"] = "7fYgJK9M4vB1CvBZ6jEsPGxYK9UD1hEnI6NqTxNGs";</pre>
</blockquote>
<p>
</p>
<p>Your Potlatch 2 instance is now ready to go!
</p>
<p>For more information about deploying Potlatch 2 please see: <a href="http://wiki.osm.org/wiki/Potlatch_2/Deploying_Potlatch_2">http://wiki.osm.org/wiki/Potlatch_2/Deploying_Potlatch_2</a>
</p>
<h2>Editing controls
</h2>
<p>The icons on the left side of the Potlatch 2 editor are defined by the XML file resources/map_features.xml. This XML file is commonly called a presets file. There are links to other files within this file to group together some of the controls, rather than having a single very large file that is difficult to work with. To link an additional xml file to the map_features.xml file you use the "include" tag.
</p>
<pre>&lt;include file="map_features/barriers.xml" /&gt;</pre>
<p><em>Note: Nested files should also be valid XML, which means they should have a single root element - by convention, &lt;featureGroup/&gt;.</em>
</p>
<p>There are specific conventions for the types of XML tags you add to the presets files.
</p>
<p>A <strong>feature</strong> is the distinct, recognizable type that will be presented to the user as "what this is". For example: trunk road, school, reservoir.
</p>
<p>A <strong>feature category</strong> groups features together. For example: Roads, Paths, Accommodation, Sport and Leisure.
</p>
<p>An <strong>input</strong> is a single editing control for a single tag. For example: a drop-down menu with yes/no options, or a free-text field for a name.
</p>
<p>An <strong>input set</strong> is a group of inputs. It can be reused anywhere in the file, and nested in other input sets. For example: a bridge-type drop-down (bridge tag) and a layer slider (layer tag) could together form one input set. 
</p>
<p>To use these tags to create a simple tag editor, you should initially create the specific feature you are interested in, for example "school". Then define the category it belongs to, in this case "education". You then need to define what type of shape it applies to - for example can it be a point, a line or an area? In this case a school could either be a point or an area. Add the tags that define the feature and the inputs that the user can add or edit for this feature. An example snippet of XML for a school is below.</p>
<pre> &lt;feature name="School"&gt;
	&lt;category&gt;eduction&lt;/category&gt;
	&lt;icon image="features/school.png"&gt;${name}&lt;/icon&gt;
	&lt;help&gt;http://wiki.openstreetmap.org/wiki/Tag:amenity%3Dschool&lt;/help&gt;
	&lt;point/&gt;
	&lt;area/&gt;
	&lt;tag k="amenity" v="school"/&gt;
	&lt;inputSet ref="buildingInfo"/&gt;
&lt;/feature&gt;</pre>
<p>In this particular example there are a couple specifics that bear mentioning.  Both the "&lt;point/&gt;" and "&lt;area/&gt;" show that schools can be drawn as a point or an area.  Additionally the "${name}" is the actual name of the feature.</p><p>The <strong>line, area, point</strong> and <strong>relation</strong> elements define what entity type this feature can be. For example, a trunk road could be &lt;line/&gt; or &lt;area/&gt; (for roundabouts); a supermarket could be &lt;area/&gt; or &lt;point/&gt;; a football pitch or baseball field could only be &lt;area/&gt;.
</p>
<p>The <strong>tag</strong> elements define all the tags that identify this feature.
</p>
<p>The <strong>name</strong> attribute defines the name displayed in drop-down menus from which the user can choose.
</p>
<p>The <strong>category</strong> element defines the feature category (see below) in which this feature is be grouped.
</p>
<p>The <strong>help</strong> element defines a URL providing more information about this feature.
</p>
<p>The <strong>input</strong> elements define editing controls available for this feature (see below).
</p>
<p>The <strong>inputSet</strong> elements reference input sets (groups of editing controls) available for this feature. Their ref attribute relates to the id of an inputSet defined elsewhere in the file (see below).
</p>
<p>The <strong>icon</strong> element defines a feature's graphical appearance within the tag panel. 
</p>
<h3>Tag element syntax 
</h3>
<p>The <strong>tag</strong> elements define all the tags that identify this feature. Often this will just be a single tag (for example, highway=trunk) but you may also specify more than one element (e.g. amenity=public_building; building=yes).
</p>
<p>For each one, its <strong>k</strong> attribute defines the key to match, and its <strong>v</strong> attribute defines the value to match. These tags will be applied to the object when the user chooses this feature from the drop-down menu.
</p>
<p>The optional <strong>vmatch</strong> attribute allows you to specify values which are matched, but not applied. This is useful for compatibility with legacy or minority tagging schemes. The attribute is parsed as a regular expression (the special value "*" means "any value"). For example:
</p>
<pre>&lt;tag k="route" v="hiking" vmatch="hiking|foot"/&gt; </pre>
<h3>Icon element syntax
</h3>
<p>The <strong>icon</strong> element defines a feature's graphical appearance within the tag panel. It is usually found within a &lt;feature/&gt;, but the same format is also used for route relation inputs (see below).
</p>
<p>Its <strong>image</strong> attribute is the URL of an image to be shown when the feature is selected, and when the drop-down menu is open.
</p>
<p>Its <strong>dnd</strong> attribute is the URL of an image to be shown in the drag-and-drop icon panel (default: same as image attribute).
</p>
<p>Its <strong>background</strong> and <strong>foreground</strong> attributes are the colours in which the HTML fragment will be displayed.
</p>
<p>Its content is an HTML fragment displayed next to the image when the feature is selected. Tag values (such as name and ref) may be embedded by using the ${key} syntax. 
</p>
<h3>Feature categories
</h3>
<p>A <strong>feature category</strong> groups features together. Example categories include roads, paths, accommodations, sports, and leisure. Specifics in these categories appear in the main drop-down feature menu for example in the roads category specific types of roads would show such as residential, primary, and secondary.</p>
<p>You define a feature category like this:
</p>
<pre>&lt;category name="Roads" id="roads"/&gt; </pre>
<p>To assign a feature to that category, use the &lt;category&gt; tag within the &lt;feature&gt; element. For example:
</p>
<pre>&lt;category&gt;roads&lt;/category&gt; </pre>
<h3>Inputs
</h3>
<p>An <strong>input</strong> is a single editing control for a single tag. It is usually an element within a &lt;feature/&gt;. To allow inputs to be shared between features, it can also form part of an &lt;inputSet/&gt; (see below).
</p>
<p>The simplest form of input is a freetext input:
</p>
<pre>&lt;input type="freetext" presence="always" category="Naming" name="Ref" key="ref" description="Reference number of the road"/&gt; </pre>
<p>The <strong>key</strong> attribute defines which OSM key will be edited (for example, "highway").
</p>
<p>The <strong>name</strong> attribute defines a label shown by the control.
</p>
<p>The <strong>description</strong> attribute defines a tooltip shown on mouse-over.
</p>
<p>The <strong>layout</strong> attribute defines whether the control's layout will be 'horizontal' or 'vertical' (default).
</p>
<p>The <strong>category</strong> attribute in the input tag defines the name of the tab that the input will be shown under (not related to feature categories).</p>
<p>The <strong>subcategory</strong> attribute (optional) defines a subgroup under that tab (intended for lesser-used tags).
</p>
<p>The <strong>presence</strong> attribute defines whether this input should be shown on the 'Basic' tab:
</p>
<ul><li><strong>always</strong> - always show</li>
  <li><strong>onTagMatch</strong> - only show if the tag is set</li>
  <li><strong>withCategory</strong> - don't show on the Basic tab</li>
</ul><p>The <strong>priority</strong> attribute controls ordering within the tab. The possible values going from the highest priority to the lowest are highest, high, normal, low and lowest. </p>
<p>The <strong>type</strong> attribute defines what control this is. The rest of this section defines these controls and their attributes.</p>
<h4>type="choice"</h4>
<p>A drop-down menu. &lt;choice/&gt; elements are used to define the options available (like &lt;option/&gt; in an HTML &lt;/select&gt; element). For example:
</p>
<pre>&lt;input type="choice" presence="always" category="" name="Religion" key="religion" description="The religion worshipped here."&gt;
     &lt;choice value="christian" text="Christianity (church)"/&gt;
     &lt;choice value="jewish" text="Judaism (synagogue)"/&gt;
     &lt;choice value="muslim" text="Islam (mosque)"/&gt;
&lt;/input&gt; </pre>
<h4>type="checkbox"  </h4>
<p>A checkbox used to set the tag value to 'yes' or 'no'. (Values of "1", "0", "true" and "false" are recognised but not set.)</p><h4>type="freetext"</h4><p>A simple text editor. You can use the <strong>absenceText</strong> attribute to define the value when not set. </p><p><strong>type="number"</strong></p><p><span class="Apple-style-span">A numeric entry textfield with additional "up" and "down" nudge buttons beside it. For example:</span></p><pre> &lt;input type="number" minimum="0" maximum="99999" stepSize="1"
         presence="always" category="Parking" name="Capacity" key="capacity" description="The number of cars that can be parked in the car park"/&gt;</pre><blockquote class="webkit-indent-blockquote"><p>The <strong>minimum</strong> and <strong>maximum</strong> attributes define the range of values allowed by the nudge buttons (default 0, 100).</p></blockquote><blockquote class="webkit-indent-blockquote"><p>The <strong>stepSize</strong> attribute defines the increment of clicking on an up/down nudge button (default 1).</p></blockquote><blockquote class="webkit-indent-blockquote"><p>The <strong>absenceText</strong> attribute defines text to be shown if the value is not set.</p></blockquote><blockquote class="webkit-indent-blockquote"><p>The <strong>notValidText</strong> attribute defines text to be shown if the value is not a number, or outside the minimum/maximum values. </p></blockquote>
<h4>type="slider"</h4>
<p>A slider allowing any numeric value to be chosen between two extremes. For example:
</p>
<pre>&lt;input type="slider" presence="onTagMatch"
       name="Layer" category="Physical" description="Relative vertical positions (-5 lowest, +5 highest)"
       key="layer" minimum="-5" maximum="5" default="0" snapInterval="1" labels="Lowest,Ground,Highest"
       defaultName="Ground"/&gt; </pre>
<blockquote class="webkit-indent-blockquote"><p>The <strong>minimum</strong> and <strong>maximum</strong> attributes define the range of values allowed (default 0,100).
</p></blockquote>
<blockquote class="webkit-indent-blockquote"><p>The <strong>snapInterval</strong> attribute defines the minimum increment between these values (default 1).
</p></blockquote>
<blockquote class="webkit-indent-blockquote"><p>The <strong>default</strong> attribute defines the default numeric value if not set (default 0).
</p><p>The <strong>labels</strong> attribute is a comma-separated list of labels to be laid out at equal intervals from minimum to maximum values. 
</p><p>A numeric entry textfield with additional "up" and "down" nudge buttons beside it. For example: </p></blockquote>



<pre>&lt;input type="number" minimum="0" maximum="99999" stepSize="1"
       presence="always" category="Parking" name="Capacity" key="capacity" description="The number of cars that can be parked in the car park"/&gt; </pre>
<blockquote class="webkit-indent-blockquote"><p>The <strong>minimum</strong> and <strong>maximum</strong> attributes define the range of values allowed by the nudge buttons (default 0, 100).
</p><p>The <strong>stepSize</strong> attribute defines the increment of clicking on an up/down nudge button (default 1).
</p><p>The <strong>absenceText</strong> attribute defines text to be shown if the value is not set.
</p><p>The <strong>notValidText</strong> attribute defines text to be shown if the value is not a number, or outside the minimum/maximum values. 
</p></blockquote>



<h4>type="speed"</h4>
<p>A dedicated speed-limit editor. 
</p>
<h4>type="route"</h4>
<p>A dedicated route relation editor, showing route relations of which this entity is a member, and allowing the user to add it to other route relations. For example:
</p>
<pre>&lt;input type="route" name="National Cycle Routes" description="A signposted route in a National Cycle Network, or nearest equivalent." category="Cycle" priority="low"&gt;
  &lt;match k="type" v="route"/&gt;
  &lt;match k="route" v="bicycle"/&gt;
  &lt;match k="network" v="ncn"/&gt;
  &lt;icon image="features/route__ncn.png" background="#ff6f7a" foreground="white"&gt;${ref} ${name}&lt;/icon&gt;
&lt;/input&gt; </pre>
<blockquote class="webkit-indent-blockquote"><p>The <strong>match</strong> elements define the tags required for a parent relation to match.
</p><p>The <strong>icon</strong> element defines the appearance of the control shown for a matching relation (same syntax as an &lt;icon/&gt; within a &lt;feature/&gt;).
</p></blockquote>

<h4>type="turn"</h4>
<p>A dedicated turn restriction editor, showing turn restrictions of which this entity is a member, and allowing the user to add it to other turn restrictions. For example:
</p>
<pre>&lt;input type="turn" name="Turn restriction" description="Turn restriction" category="Turn" priority="normal" presence="onTagMatch"&gt;
   &lt;match k="type" v="restriction"/&gt;
   &lt;role role="via"/&gt;
 &lt;/input&gt; </pre>
<blockquote class="webkit-indent-blockquote"><p>The <strong>match</strong> elements define the tags required for a parent relation to match.
</p><p>The <strong>role</strong> element defines the member role required for a parent relation to match. 
</p></blockquote>

<h3>Input sets 
</h3>
<p>An <strong>input set</strong> is a group of inputs. It can be reused by any feature.
</p>
<p>It contains &lt;input/&gt; elements as per above. For example:
</p>
<pre>&lt;inputSet id="roadRefs"&gt;
  &lt;input type="freetext" presence="always" name="Reference" category="Naming" priority="high" key="ref" /&gt;
  &lt;input type="freetext" presence="onTagMatch" name="International Reference" category="Naming" key="int_ref" /&gt;
  &lt;input type="freetext" presence="onTagMatch" name="Old Reference" category="Naming" priority="low" key="old_ref" /&gt;
&lt;/inputSet&gt; </pre>
<p>An inputSet can also contain other, nested inputSet elements:
</p>
<pre>&lt;inputSet id="common"&gt;
  &lt;inputSet ref="source"/&gt;
  &lt;inputSet ref="designation"/&gt;
&lt;/inputSet&gt; </pre>
<p>For the latest information about editing the controls for the simple editor of Potlatch 2 please see: <a href="http://wiki.osm.org/wiki/Potlatch_2/Developer_Documentation/Map_Features">http://wiki.osm.org/wiki/Potlatch_2/Developer_Documentation/Map_Features</a>
</p>
<h2>Map style
</h2>
<p>You can also customise the style of the map displayed by Potlatch 2.  This is defined using the MapCSS form, which is very similar to cascading style-sheets.  If you are familiar with the basics of making webpages this part should not be too difficult for you. 
</p>
<p>The style of the map is defined by MapCSS, which is similar to the CSS format. For more information about the MapCSS specification please take a look at: <a href="http://wiki.osm.org/wiki/MapCSS/0.2">http://wiki.openstreetmap.org/wiki/MapCSS/0.2</a>
</p></div><ul Class="menu-goes-here"><li Class="booki-section">Johdanto</li><li><a href="/openstreetmap/index">Löydä yhteisöllinen kartoitus</a></li>
<li><a href="/openstreetmap/ch002_welcome-to-openstreetmap">Tervetuloa OpenStreetMapin käyttäjäksi!</a></li>
<li><a href="/openstreetmap/ch003_about-this-book">Tästä kirjasta</a></li>
<li Class="booki-section">Aloittaminen</li><li><a href="/openstreetmap/ch005_my-first-edit">Ensimmäinen muokkauksesi</a></li>
<li><a href="/openstreetmap/ch006_collecting-data">Tiedon kerääminen</a></li>
<li><a href="/openstreetmap/ch007_sharing-your-maps">Kartan jakaminen</a></li>
<li Class="booki-section">OpenStreetMapin editoiminen</li><li><a href="/openstreetmap/ch009_introduction-to-editing-in-openstreetmap">Johdanto editointiin OpenStreetMapissa</a></li>
<li><a href="/openstreetmap/ch010_editing-with-the-online-editor-potlatch-2">Editointi Potlach 2 -verkkoeditorilla</a></li>
<li><a href="/openstreetmap/ch011_editing-with-the-offline-editor-josm">Editointi työpöydällä JOSM-editorilla</a></li>
<li><a href="/openstreetmap/ch012_editing-with-mobile-editors">Editointi mobiilieditoreilla</a></li>
<li Class="booki-section">Tee kartasta omasi</li><li><a href="/openstreetmap/ch014_taking-openstreetmap-data-with-you">Ota OpenStreetMap mukaasi</a></li>
<li><a href="/openstreetmap/ch015_customising-potlatch-2">Potlach 2:n kustomointi</a></li>
<li><a href="/openstreetmap/ch016_understanding-the-openstreetmap-data-model">OpenStreetMapin tietomalli</a></li>
<li><a href="/openstreetmap/ch017_providing-maps-for-your-web-site">Karttojen liittäminen verkkosivulle</a></li>
<li Class="booki-section">Lisätietoa</li><li><a href="/openstreetmap/ch019_exploring-the-openstreetmap-community">Tutkimusmatka OpenStreetMap-yhteisöön</a></li>
<li><a href="/openstreetmap/ch020_useful-websites-and-references">Hyödylliset verkkosivut ja lähteet</a></li>
<li><a href="/openstreetmap/ch021_credits">Tekijät</a></li>
</ul>